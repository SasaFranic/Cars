name: Laravel CI
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

permissions:
  contents: read

jobs:
    laravel-tests:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v3
            - name: Setup PHp environmet
              uses: shivammathur/setup-php@v2
              with:
                php-version: '8.4'
                extensions: mbstring, dom, fileinfo, mysql
                coverage: none
            - name: Copy .env file
              run: php -r "file_exists('.env') || copy('.env.example', '.env');"
            - name: Install dependencies
              run: composer install -q --no-progress --prefer-dist --optimize-autoloader
            - name: Generate Key
              run: php artisan key:generate
            - name: Create Database
              run: |
                mkdir -p dataabase
                touch database/database.sqlite
            - name: Run Migrations
              env:
                DB_CONNECTION: sqlite
                DB_DATABASE: database/database.sqlite
              run: php artisan migrate
            - name: Execute tests (PHPUnit)
              env:
                DB_CONNECTION: sqlite
                DB_DATABASE: database/database.sqlite
              run: php artisan test

                